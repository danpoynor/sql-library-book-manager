extends ../layout

block content
  include ../includes/subhead.pug

  p
    a(class="button" href="/books/new")
      | Create Book &#43;

  if(books.length === 0)
    p.errors
      | No books found.
  else
    table
      thead
        tr
          th Title
          th Author
          th Genre
          th Year
          th Actions
      tbody.hover-row
        each book in books
          tr
            td
              a(href=`/books/${book.id}`)= book.title
            td
              //- Since book validation requires an author this shouldn't be needed
              //- in production, but it's here for devtime convenience.
              if book.Author
                a(href=`/authors/${book.Author.id}`)= book.Author.fullName()
              else
                span.errors No Author
            td
              //- Add comma with a space after each genre
              if book.Genres && book.Genres.length > 0
                each genre, index in book.Genres
                  a(href=`/genres/${genre.id}`)= genre.name
                  = book.Genres.length -1 !== index ? ', ' : ''
              else
                span.errors No Genres
            td
              if(book.year)
                = book.year
              else
                span.errors No Year
            td.actions
              a(href=`/books/${book.id}`)
                | View
              a(href=`/books/${book.id}/edit`)
                | Edit
              a(href=`/books/${book.id}/delete`)
                | Delete
